{% extends "base/base.html" %}

{% block title %}Create Memo{% endblock %}

{% block additional_css %}
    <style>
        body, html {
            height: 100%;
            margin: 0;
            background-color: #121212;
            color: #ffffff;
            font-family: Arial, sans-serif;
        }

        .container {
            margin-top: 90px;
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        .input-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 900px;
            margin: 0 auto;
            align-items: center;
        }

        .form__group {
            position: relative;
            padding: 15px 0 0;
            margin-top: 10px;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .form__field {
            font-family: inherit;
            width: 100%;
            border: 0;
            border-bottom: 2px solid #9b9b9b;
            outline: 0;
            font-size: 1.3rem;
            color: #fff;
            padding: 7px 0;
            background: transparent;
            transition: border-color 0.2s;
        }

        .form__field::placeholder {
            color: transparent;
        }

        .form__field:placeholder-shown ~ .form__label {
            font-size: 1.3rem;
            cursor: text;
            top: 20px;
        }

        .form__label {
            position: absolute;
            top: 0;
            display: block;
            transition: 0.2s;
            font-size: 1rem;
            color: #9b9b9b;
        }

        .form__field:focus {
            padding-bottom: 6px;
            font-weight: 700;
            border-width: 3px;
        }

        .form__field:focus ~ .form__label {
            position: absolute;
            top: 0;
            display: block;
            transition: 0.2s;
            font-size: 1rem;
            color: #11998e;
            font-weight: 700;
        }

        .form__field:required, .form__field:invalid {
            box-shadow: none;
        }

        .submit-button {
            padding: 10px 20px;
            background-color: #1e90ff;
            border: 2px solid #ffffff;
            border-radius: 5px;
            color: #ffffff;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        .submit-button:hover {
            background-color: #1c86ee;
            transform: scale(1.05);
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background-color: #1e90ff;
            border: 2px solid #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .back-button svg {
            width: 20px;
            height: 20px;
            fill: #ffffff;
        }

        .char-count {
            font-size: 0.9rem;
            color: #9b9b9b;
            margin-top: 5px;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="back-button" id="backButton">
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 48 48">
                <path fill="currentColor" fill-rule="evenodd" stroke="currentColor" stroke-linejoin="round"
                      stroke-width="4"
                      d="M44 40.836c-4.893-5.973-9.238-9.362-13.036-10.168c-3.797-.805-7.412-.927-10.846-.365V41L4 23.545L20.118 7v10.167c6.349.05 11.746 2.328 16.192 6.833c4.445 4.505 7.009 10.117 7.69 16.836Z"
                      clip-rule="evenodd">
                </path>
            </svg>
        </div>
        <form id="memoForm" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="input-container">
                <div class="form__group">
                    <input type="text" class="form__field" placeholder="Title" id="title" name="title" required
                           maxlength="100"/>
                    <label for="title" class="form__label">Title</label>
                    <span id="titleCount" class="char-count">0/100</span>
                </div>

                <div class="form__group">
                    <input type="text" class="form__field" placeholder="Description" id="description" name="description"
                           required maxlength="250"/>
                    <label for="description" class="form__label">Description</label>
                    <span id="descriptionCount" class="char-count">0/250</span>
                </div>

                <div class="form__group">
                    <textarea class="form__field" placeholder="Body" id="body" name="body" rows="6" required></textarea>
                    <label for="body" class="form__label">Body</label>
                    <span id="bodyCount" class="char-count">0/∞</span>
                </div>

                <button class="submit-button" type="button" onclick="submitForm()">Create</button>
            </div>
        </form>
    </div>

    <script>
      document.getElementById('title').addEventListener('input', function () {
        const maxLength = this.maxLength;
        const currentLength = this.value.length;
        document.getElementById('titleCount').textContent = `${currentLength}/${maxLength}`;
      });

      document.getElementById('description').addEventListener('input', function () {
        const maxLength = this.maxLength;
        const currentLength = this.value.length;
        document.getElementById('descriptionCount').textContent = `${currentLength}/${maxLength}`;
      });


      document.getElementById('body').addEventListener('input', function () {
        const currentLength = this.value.length;
        document.getElementById('bodyCount').textContent = `${currentLength}/∞`;
      });
    </script>


    <script>
      document.getElementById('backButton').addEventListener('click', function (event) {
        const title = document.getElementById('title').value;
        const description = document.getElementById('description').value;
        const body = document.getElementById('body').value;

        if (title || description || body) {
          if (confirm("Are you sure you want to leave this page? All unsaved data will be lost.")) {
            window.location.href = "{% url 'user_page' %}";
          } else {
            event.preventDefault();
          }
        } else {
          window.location.href = "{% url 'user_page' %}";
        }
      });
    </script>

    <script>
      function getCSRFToken() {
        return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
      }

      async function submitForm() {
        const title = document.getElementById('title').value;
        const description = document.getElementById('description').value;
        const body = document.getElementById('body').value;

        if (title.length > 100) {
          alert("Title cannot exceed 100 characters.");
          return;
        }

        if (description.length > 250) {
          alert("Description cannot exceed 250 characters.");
          return;
        }

        if (!title || !body) {
          alert("Title and body are required.");
          return;
        }

        console.log(title)
        console.log(description)
        console.log(body)

        const formData = new FormData();
        formData.append('title', title);
        formData.append('description', description);
        formData.append('body', body);

        try {
          const response = await fetch("{% url 'create_memo_page' %}", {
            method: 'POST',
            body: formData,
            headers: {
              'X-CSRFToken': getCSRFToken()
            }
          });

          if (response.ok) {
            window.location.href = "{% url 'user_page' %}";
          } else {
            alert("There was an error processing your request.");
          }
        } catch (error) {
          console.error("Error:", error);
          alert("There was an error processing your request.");
        }
      }

    </script>
{% endblock %}
